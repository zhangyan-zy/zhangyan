<?xml version="1.0" encoding="UTF-8"?>        <!DOCTYPE mapper PUBLIC
    "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wingscode.modules.common.dao.StatisticalDao">

    <select id="selectCustomerList" resultType="com.wingscode.modules.common.vo.AdminCustomerVO">
        SELECT
        count(*) sumLeads,
        u.username username,
        COUNT(CASE l.status WHEN 0 THEN 1 END )as status0,
        COUNT(CASE l.status WHEN 1 THEN 1 END )as status1,
        COUNT(CASE l.status WHEN 2 THEN 1 END )as status2,
        COUNT(CASE l.status WHEN 3 THEN 1 END )as status3,
        COUNT(CASE l.status WHEN 4 THEN 1 END )as status4,
        COUNT(CASE l.status WHEN 5 THEN 1 END )as status5,
        COUNT(CASE l.status WHEN 6 THEN 1 END )as status6
        FROM
        tb_leads l
        INNER JOIN sys_user u on l.parent_id =u.user_id
        WHERE 1=1
        <if test="parentId != null and parentId != ''">
            and l.parent_id=#{parentId}
        </if>
        <if test="date1 != null and date1 != '' and date2 != null and date2 != ''">
            and DATE_FORMAT(l.gmt_creat,'%m-%d-%Y') between DATE_FORMAT(#{date1},'%m-%d-%Y') and
            DATE_FORMAT(#{date2},'%m-%d-%Y')
        </if>
        GROUP BY u.user_id
    </select>


    <select id="allWorker" resultType="com.wingscode.modules.common.vo.AdminWorkerVO">

         SELECT
        (SELECT username FROM sys_user su WHERE su.user_id = l.parent_id) as username,
        u.username as leadsname ,
        (SELECT COUNT(1) FROM tb_leads tl WHERE tl.worker_id = l.worker_id ) as sumLeads,
        COUNT(1) as addTime,
        COUNT(distinct DATE_FORMAT(l.gmt_creat,'%Y-%m-%d')),
        (COUNT(1)/COUNT(distinct DATE_FORMAT(l.gmt_creat,'%Y-%m-%d'))) as addVagDaliy
        FROM
        tb_leads l
        INNER JOIN sys_user u on u.user_id = l.worker_id AND u.`status` = 1
        LEFT JOIN sys_user_role r on r.user_id = u.user_id
        AND r.role_id = 5
        WHERE 1=1
        <if test="parentId != 0">
            AND u.parent_id=#{parentId}
        </if>
        <if test="date1 != null and date1 != '' and date2 != null and date2 != ''">
            AND DATE_FORMAT(l.gmt_creat,'%m-%d-%Y') BETWEEN DATE_FORMAT(#{date1},'%m-%d-%Y') AND
            DATE_FORMAT(#{date2},'%m-%d-%Y')
        </if>
        GROUP BY l.worker_id
        ORDER BY sumLeads DESC
    </select>

</mapper>
